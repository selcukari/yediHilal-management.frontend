<div class="flex justify-content-center flex-wrap">
  <p-toast />
    <p-confirmdialog />

    <!-- Main Content Area (Column-8) -->
      <div>
        <h2>Toolbar</h2>
        <app-component-country (countrySelected)="onCountrySelected($event)" (countrySelectedName)="onCountrySelectedName($event)"></app-component-country>
        @if (selectedCountry == 1) {
          <app-component-area (areaSelected)="onAreaSelected($event)" (areaSelectedName)="onAreaSelectedName($event)"></app-component-area>

        }
        <app-component-province [countryCode]="selectedCountry" [areaCode]="selectedArea" (provinceSelectedName)="onProvinceSelectedName($event)"
          (provinceSelected)="onProvinceSelected($event)"></app-component-province>
      </div>

      <div class="header-section">
        <h2>Kullanıcılar</h2>
        <p-button
          pButton
          type="button"
          label="Yeni Kullanıcı"
          icon="pi pi-plus"
          (click)="onAdd()"
          [disabled]="isLoading">
        </p-button>
      </div>

      <app-component-speedDial [pdfTitle]="pdfTitle" [valueData]="sendValueData" [tableColumns]="pdfTableColumns" [type]="2">
      </app-component-speedDial>

      @if (isLoading) {
        <div class="global-loading-overlay">
          <div class="loading-content">
            <p-progressSpinner></p-progressSpinner>
            <p>Veriler yükleniyor...</p>
          </div>
        </div>
      } @else {
        <div class="announcements-section">
          <p-table
            #dt
            [value]="resultData"
            [columns]="cols"
            [paginator]="true"
            [rows]="20"
            [showCurrentPageReport]="true"
            currentPageReportTemplate="Gösterilen: {first} - {last} / Toplam: {totalRecords}"
            [globalFilterFields]="['fullName', 'telephone', 'email', 'provinceName']">

            <ng-template #caption>
              <div class="flex">
                <span class="table-title">Aktif Kullanıcılar ({{ resultData.length }})</span>
                <p-iconfield iconPosition="left" class="ml-auto">
                  <p-inputicon class="pi pi-search" />
                  <input pInputText id="on_label" (ngModelChange)="onSearchChange($event)"  [(ngModel)]="searchFullName" placeholder="Kullanıcı Ara..." pSize="large" autocomplete="off" />
                </p-iconfield>
                <p-button icon="pi pi-refresh" icon="pi pi-refresh" (click)="refreshData()" [disabled]="isLoading" pTooltip="Yenile" tooltipPosition="top" rounded raised />
              </div>
            </ng-template>

            <ng-template pTemplate="header" let-columns>
              <tr>
                <th *ngFor="let col of columns" [pSortableColumn]="col.field">
                  {{ col.header }}
                  <p-sortIcon [field]="col.field"></p-sortIcon>
                </th>
                <th>İşlemler</th>
              </tr>
            </ng-template>

            <ng-template pTemplate="body" let-rowData let-columns="columns">
              <tr>
                <td *ngFor="let col of columns">
                  @switch (col.field) {
                    @case ('createdDate') {
                      {{ formatDate(rowData[col.field]) }}
                    }
                    @case ('updateDate') {
                      {{rowData[col.field] ? formatDate(rowData[col.field]) : "-" }}
                    }

                    @default {
                      {{ rowData[col.field] || '-' }}
                    }
                  }
                </td>
                <td>
                  <div class="flex justify-center">
                      <p-button (click)="onDelete(rowData.id)" icon="pi pi-trash" [raised]="true" severity="danger" pTooltip="Sil" tooltipPosition="top" />
                      <p-button (click)="onEdit(rowData)" icon="pi pi-pencil" [raised]="true" severity="warn" pTooltip="Güncelle" tooltipPosition="top" />
                  </div>
                </td>
              </tr>
            </ng-template>

          </p-table>
        </div>
      }
</div>
<app-component-userEdit></app-component-userEdit>
<app-component-userAdd></app-component-userAdd>
