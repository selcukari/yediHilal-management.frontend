
<p-toast />
<p-confirmdialog />
<p-dialog [(visible)]="visible" [modal]="true" [style]="{ width: '45rem' }">
    <ng-template #header>
        <div class="inline-flex items-center justify-center gap-2">
            <p-avatar icon="pi pi-user" class="mr-2" size="large"  shape="circle" />
            <span class="font-bold whitespace-nowrap">{{memberData?.fullName}}</span>
        </div>
    </ng-template>
    <span class="text-surface-500 dark:text-surface-400 block mb-8">Yeni üye ekle.</span>
  <form #memberAddForm="ngForm"  class="formgrid grid">

    <div class="field grid col-12 gap-3 align-items-end">
    <!-- Ad Soyad + Ülke Kodu + Telefon -->
    <div class="col-12 flex flex-row gap-3">
      <!-- Ad Soyad -->
      <div class="flex flex-column" style="flex: 2">
        <p-floatlabel variant="on">
          <p-iconfield>
            <p-inputicon class="pi pi-user" />
            <input pInputText id="fullName" name="fullName" [(ngModel)]="memberData.fullName" #fullName="ngModel"
              pSize="large" required autocomplete="off"
              [class.ng-invalid]="fullName.invalid && (fullName.touched || memberAddForm.submitted)" />
          </p-iconfield>
          <label for="fullName">Ad Soyad</label>
        </p-floatlabel>
        @if ((!memberData.fullName || !memberData.fullName.trim()) && (fullName.touched || memberAddForm.submitted)) {
          <p-message severity="error" variant="simple" class="mt-1">Ad Soyad gereklidir.</p-message>
        }
      </div>

      <!-- Ülke Kodu -->
      <div class="flex flex-column" style="flex: 1; max-width: 70px">
        <p-floatlabel>
          <p-iconfield>
            <input pInputText id="countryCode" name="countryCode" [(ngModel)]="memberData.countryCode"
              #countryCode="ngModel" pSize="large" required autocomplete="off"
              placeholder="90" style="width: 100%" pattern="^[0-9]+$"
              [class.ng-invalid]="countryCode.invalid && (countryCode.touched || memberAddForm.submitted)" />
          </p-iconfield>
          <label for="countryCode">Ülke Kodu</label>
        </p-floatlabel>
        @if (countryCode.invalid && (countryCode.touched || memberAddForm.submitted)) {
          <p-message severity="error" variant="simple" class="mt-1">
            @if (countryCode.errors?.['required']) {
              Kod gereklidir.
            }
            @if (countryCode.errors?.['pattern']) {
              Geçerli bir sayı giriniz.
            }
          </p-message>
        }
      </div>

      <!-- Telefon Numarası -->
      <div class="flex flex-column" style="flex: 2">
        <p-floatlabel>
          <p-iconfield>
            <p-inputicon class="pi pi-phone" />
            <input pInputText id="telephone" name="telephone" [(ngModel)]="memberData.telephone"
              #telephone="ngModel" pSize="large" required autocomplete="off"
              placeholder="505 555 5555" style="width: 100%" pattern="^[0-9]+$"
              [class.ng-invalid]="telephone.invalid && (telephone.touched || memberAddForm.submitted)" />
          </p-iconfield>
          <label for="telephone">Telefon</label>
        </p-floatlabel>
        @if (telephone.invalid && (telephone.touched || memberAddForm.submitted)) {
          <p-message severity="error" variant="simple" class="mt-1">
            @if (telephone.errors?.['required']) {
              Telefon gereklidir.
            }
            @if (telephone.errors?.['pattern']) {
              Geçerli bir sayı giriniz.
            }
          </p-message>
        }
      </div>
    </div>
    </div>

    <div class="field col-12 md:col-6">
      <p-floatlabel variant="on">
          <p-iconfield>
            <p-inputicon class="pi pi-envelope" />
            <input pInputText id="email" name="email"  [(ngModel)]="memberData.email" #email="ngModel" pSize="large" email
              [class.ng-invalid]="email.invalid && (email.touched || memberAddForm.submitted)"autocomplete="off" />
              @if (email.invalid && (email.touched || memberAddForm.submitted)) {
                <p-message severity="error" variant="simple">
                  @if (email.hasError('email')) {
                    Please enter a valid email.
                  }
                </p-message>
              }
            </p-iconfield>
          <label for="email">Email</label>
      </p-floatlabel>
    </div>

    <div class="field col-12 md:col-6">
      <p-floatlabel variant="on">
          <p-iconfield>
            <p-inputicon class="pi pi-id-card" />
            <input pInputText id="identificationNumber" name="identificationNumber"  [(ngModel)]="memberData.identificationNumber" #identificationNumber="ngModel" pSize="large"/>
          </p-iconfield>
          <label for="identificationNumber">Kimlik Numara</label>
      </p-floatlabel>
    </div>

    <div class="field col-12 md:col-6 col-offset-3">
      <p-floatlabel variant="on">
        <p-iconfield>
          <p-inputicon class="pi pi-calendar" />
          <input pInputText id="dateOfBirth" name="dateOfBirth"  [(ngModel)]="memberData.dateOfBirth" #dateOfBirth="ngModel"
            [class.ng-invalid]="dateOfBirth.invalid && (dateOfBirth.touched || memberAddForm.submitted)" pattern="^[0-9]+$" pSize="large"/>
        </p-iconfield>
        <label for="dateOfBirth">Doğum Tarih</label>
      </p-floatlabel>
      @if (dateOfBirth.invalid && (dateOfBirth.touched || memberAddForm.submitted)) {
        <p-message severity="error" variant="simple" class="mt-1">
          @if (dateOfBirth.errors?.['pattern']) {
            Geçerli bir sayı giriniz.
          }
        </p-message>
      }
    </div>
    <div class=" col-offset-3"></div>

    <div class="field col-12 md:col-5 mr-4">
      <app-component-country (countrySelected)="onCountrySelected($event)" [model]="memberData.countryId" [isRequired]="true">
      </app-component-country>
    </div>

    @if (memberData.countryId == 1) {
      <div class="field col-12 md:col-6">
        <app-component-area (areaSelected)="onAreaSelected($event)" [isRequired]="!!(memberData.countryId == 1)"></app-component-area>
      </div>
    }

    @if ((memberData.countryId == 1 && memberData.areaId) || (memberData.countryId && memberData.countryId !=1)) {
      <div class="field col-12 md:col-6">
        <app-component-province [areaCode]="changeAreaCode" [countryCode]="changeCountryCode" [isRequired]="true"
          (provinceSelected)="onProvinceSelected($event)"></app-component-province>
      </div>
    }

    <div class="field col-12 md:col-4">
      <label for="isSms" class="ml-4 mr-2">Mesaj Durumu:</label>
      <p-toggleswitch id="isSms" name="isSms" [(ngModel)]="memberData.isSms" />
    </div>

    <div class="field col-12 md:col-4">
      <label for="isMail" class="mr-2">Mail Durumu:</label>
      <p-toggleswitch id="isMail" name="isMail" [(ngModel)]="memberData.isMail" />
    </div>

    <div class="field col-12 md:col-6">
      <label for="isActive" class="mr-2">Aktif Durumu:</label>
      <p-toggleswitch id="isActive" name="isActive" [(ngModel)]="memberData.isActive" />
    </div>

    </form>
    <ng-template #footer class="mt-5">
        <p-button label="Cancel" [text]="true" severity="secondary" [raised]="true" severity="danger" (click)="onCancel(memberAddForm)" />
        <p-button label="Save" [outlined]="true" severity="secondary" [raised]="true" severity="success" icon="pi pi-check" iconPos="left" (click)="onSave(memberAddForm)" />
    </ng-template>
</p-dialog>

